<HTML>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    </head>
    <body>
        <h2>Słownik prefiksowy</h2>
        <p><em>Słownikiem prefiksowym</em> nazywamy strukturę danych przechowującą napisy, pozwalającą wykonywać następujące operacje:</p>
        <ul>
            <li>wstawienie napisu do słownika</li>
            <li>usunięcie napisu ze słownika</li>
            <li>zapytanie, czy któreś słowo ze słownika ma prefiks (tj. początkowy fragment) taki jak dany wzorzec.</li>
        </ul>
        <p>Twoim zadaniem będzie implementacja słownika prefiksowego.</p>
        <h3>Operacje na słowniku</h3>
        <p>Słowa wstawiane do słownika otrzymują kolejne numery, począwszy od 0. Każde ze słów w zapytaniach jest niepustym ciągiem małych liter alfabetu angielskiego. Oto pełna lista operacji na słowniku prefiksowym:</p>
        <ul>
            <li><span style="font-family: courier new,courier,monospace;">insert</span> <em>word</em><br>Wstawia podane słowo <em>word</em> do słownika.</li>
            <li><span style="font-family: courier new,courier,monospace;">prev</span> <em>number</em> <em>start</em> <em>end</em><br>Wstawia do słownika słowo będące podsłowem słowa o numerze <em>number</em>, zaczynającym się na pozycji <em>start</em> i kończącym się na pozycji <em>end</em> (włącznie z tymi dwiema pozycjami). <span style="color: #00ff00;">W poprawnym poleceniu zakładamy, że <em>start</em> &lt;= <em>end</em> oraz że słowo o numerze <em>number</em> znajduje się obecnie w słowniku.</span> Pozycje liter w słowach numerujemy od 0.</li>
            <li><span style="font-family: courier new,courier,monospace;">delete</span> <em>number</em><br>Usuwa ze słownika słowo o numerze <em>number</em>. <span style="color: #00ff00;">Nie wpływa na wartość licznika wstawianych słów.</span></li>
            <li><span style="font-family: courier new,courier,monospace;">find</span> <em>pattern</em><br>Daje w wyniku <span style="font-family: courier new,courier,monospace;">YES</span> albo <span style="font-family: courier new,courier,monospace;">NO</span>, w zależności od tego, czy któreś ze słów w słowniku ma prefiks równy słowu <em>pattern</em>.</li>
            <li><span style="font-family: courier new,courier,monospace;">clear</span><br>Całkowicie czyści słownik: usuwa wszystkie słowa ze słownika, tak że ewentualne kolejne wstawione słowo otrzyma numer 0.</li>
        </ul>
        <p>Jeśli podczas wykonywania którejś z operacji <span style="font-family: courier new,courier,monospace;">insert</span> lub <span style="font-family: courier new,courier,monospace;">prev</span> próbowalibyśmy wstawić słowo, które znajduje się już w słowniku, to taką operację należy zignorować. Podobnie w przypadku ponownego usuwania słowa, które już raz usunęliśmy ze słownika.</p>
        <h3>Drzewo TRIE</h3>
        <p>Słownik prefiksowy należy zaimplementować za pomocą <a href="http://pl.wikipedia.org/wiki/Drzewo_trie">drzewa TRIE</a> (<a href="http://en.wikipedia.org/wiki/Trie">opis w wersji anglojęzycznej</a>). Jako że liczba wszystkich węzłów tego drzewa mogłaby być duża (wskutek wykonywania operacji <span style="font-family: courier new,courier,monospace;">prev</span>), drzewo należy przechowywać w postaci skompresowanej (tzw. <a href="http://pl.wikipedia.org/wiki/Skompresowane_drzewo_trie">drzewo PATRICIA</a> lub <a href="http://en.wikipedia.org/wiki/Radix_tree">Radix tree</a>), czyli pamiętać tylko następujące węzły:</p>
        <ul>
            <li>korzeń drzewa - jeśli drzewo jest niepuste, oraz</li>
            <li>węzły odpowiadające całym słowom ze słownika prefiksowego, oraz</li>
            <li>węzły mające więcej niż jedno dziecko.</li>
        </ul>
        <p>Etykieta na każdej krawędzi jest niepustym ciągiem znaków. Do reprezentacji dzieci węzła można użyć zwykłej tablicy indeksowanej pierwszymi literami na krawędziach. Program powinien umożliwiać wypisywanie liczby przechowywanych węzłów drzewa.</p>
        <h3>Dane i wyniki</h3>
        <p>Twój program powinien wczytywać polecenia ze standardowego wejścia i wypisywać odpowiedzi na standardowe wyjście. Poszczególne polecenia dla programu będą podawane w osobnych wierszach. Poprawne polecenia są jednej z następujących postaci:<br><br><span style="font-family: courier new,courier,monospace;">insert</span> <em>word</em><br><span style="font-family: courier new,courier,monospace;">prev</span> <em>number</em> <em>start</em> <em>end</em><br><span style="font-family: courier new,courier,monospace;">delete</span> <em>number</em><br><span style="font-family: courier new,courier,monospace;">find</span> <em>pattern</em><br><span style="font-family: courier new,courier,monospace;">clear</span><br><br>W opisie poprawnego polecenia są dopuszczalne wielokrotne spacje zamiast pojedynczych, a także dodatkowe spacje na początku i na końcu opisu polecenia, ale nie są dopuszczalne żadne inne dodatkowe znaki. Liczby całkowite podane na wejściu nie mogą mieć zer wiodących (Czyli liczba 001 nie jest dozwolona. Liczba 0 jest jedyną dozwoloną liczbą z wiodącym zerem.) Parametry w poprawnych poleceniach muszą odpowiadać istniejącym słowom i pozycjom w słowach i spełniać wszystkie warunki wymienione w sekcji "Operacje na słowniku". W przypadku, gdy polecenie w danym wierszu nie jest poprawne, Twój program powinien zignorować to polecenie, wypisać na standardowe wyjście wiersz:<br><br><span style="font-family: courier new,courier,monospace;">ignored</span><br><br>i przejść do następnego wiersza wejścia.<br><br>Twój program powinien wypisywać odpowiedzi na poprawne polecenia w osobnych wierszach. Wynikiem dla zapytania typu <span style="font-family: courier new,courier,monospace;">find</span> powinno być jedno słowo <span style="font-family: courier new,courier,monospace;">YES</span> albo <span style="font-family: courier new,courier,monospace;">NO</span>. Wynikiem dla każdej poprawnej operacji <span style="font-family: courier new,courier,monospace;">insert</span> i <span style="font-family: courier new,courier,monospace;">prev</span> powinien być numer, jaki został nadany w słowniku nowo wstawionemu wzorcowi, podany w postaci:</p>
        <p><span style="font-family: courier new,courier,monospace;">word number:</span> <em>number</em></p>
        <p><span style="color: #ff0000;">Wynikiem dla każdej poprawnej operacji <span style="font-family: courier new,courier,monospace;">delete</span> powinno być:</span></p>
        <p><span style="color: #ff0000;"><span style="font-family: courier new,courier,monospace;">deleted:</span> <em>number</em></span></p>
        <p><span style="color: #ff0000;">Wynikiem dla każdej poprawnej operacji <span style="font-family: courier new,courier,monospace;">clear</span> powinno być jedno słowo <span style="font-family: courier new,courier,monospace;">cleared</span>.</span></p>
        <p>Jeśli dodatkowo program zostanie wywołany z parametrem <span style="font-family: courier new,courier,monospace;">-v</span>, powinien dla każdego z poleceń poza <span style="font-family: courier new,courier,monospace;">find</span> wypisać na standardowe wyjście diagnostyczne (<span style="font-family: courier new,courier,monospace;">stderr</span>) następujący wiersz:<br><br><span style="font-family: courier new,courier,monospace;">nodes: <em><span style="font-family: Trebuchet MS,Verdana,Arial,Helvetica,sans-serif;">n</span></em></span><br><br>gdzie <span class="MathJax_Preview" style="display: none;"></span><span class="MathJax" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-1"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 120%;"><span style="position: absolute; top: -2.484em; left: 0em; clip: rect(1.865em 1000em 2.671em -0.52em);"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: STIXGeneral; font-style: italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.484em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.54em; vertical-align: -0.011em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1">n</script> to liczba całkowita – łączna liczba węzłów drzewa TRIE przechowywanych w pamięci po wykonaniu tego zapytania. Nie dopuszczamy innych parametrów wywołania (w przypadku napotkania innego parametru, program powinien poinformować o błędzie).</p>
        <h3>Ograniczenia</h3>
        <p>Twój program nie musi sprawdzać następujących ograniczeń:</p>
        <ul>
            <li>Długość żadnego wiersza pliku wejściowego nie przekroczy <span class="MathJax_Preview" style="display: none;"></span><span class="MathJax" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-4"><span style="display: inline-block; position: relative; width: 1.543em; height: 0px; font-size: 120%;"><span style="position: absolute; top: -2.484em; left: 0em; clip: rect(1.416em 1000em 2.676em -0.423em);"><span class="mrow" id="MathJax-Span-5"><span class="msubsup" id="MathJax-Span-6"><span style="display: inline-block; position: relative; width: 1.515em; height: 0px;"><span style="position: absolute; top: -2.484em; left: 0em; clip: rect(1.63em 1000em 2.676em -0.423em);"><span class="mn" id="MathJax-Span-7" style="font-family: STIXGeneral;">10</span><span style="display: inline-block; width: 0px; height: 2.484em;"></span></span><span style="position: absolute; top: -2.887em; left: 1.084em;"><span class="mn" id="MathJax-Span-8" style="font-size: 70.7%; font-family: STIXGeneral;">5</span><span style="display: inline-block; width: 0px; height: 2.484em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.484em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.084em; vertical-align: -0.017em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-2">10^5</script>.</li>
            <li>Rozmiar pliku wejściowego nie przekroczy 2 MB.</li>
            <li>Suma długości wszystkich słów w słowniku (tj. suma długości wszystkich słów wstawianych za pomocą operacji <span style="font-family: courier new,courier,monospace;">insert</span> i <span style="font-family: courier new,courier,monospace;">prev</span>) nie przekroczy <span style="color: #ff0000;">3 *</span><span style="color: #000000;"> <span class="MathJax_Preview" style="display: none;"></span><span class="MathJax" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-9"><span style="display: inline-block; position: relative; width: 1.543em; height: 0px; font-size: 120%;"><span style="position: absolute; top: -2.484em; left: 0em; clip: rect(1.425em 1000em 2.676em -0.423em);"><span class="mrow" id="MathJax-Span-10"><span class="msubsup" id="MathJax-Span-11"><span style="display: inline-block; position: relative; width: 1.515em; height: 0px;"><span style="position: absolute; top: -2.484em; left: 0em; clip: rect(1.63em 1000em 2.676em -0.423em);"><span class="mn" id="MathJax-Span-12" style="font-family: STIXGeneral;">10</span><span style="display: inline-block; width: 0px; height: 2.484em;"></span></span><span style="position: absolute; top: -2.887em; left: 1.084em;"><span class="mn" id="MathJax-Span-13" style="font-size: 70.7%; font-family: STIXGeneral;">8</span><span style="display: inline-block; width: 0px; height: 2.484em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.484em;"></span></span></span><span style="border-left-width: 0em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.073em; vertical-align: -0.017em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-3">10^8</script></span>.<span style="color: #ff0000;"> Programy o złożoności pamięciowej liniowej względem sumy długości wszystkich słów w słowniku (czyli przechowujące jawnie w pamięci wszystkie słowa wstawiane za pomocą operacji <span style="font-family: courier new,courier,monospace;">prev</span>) są narażone na przekroczenie limitu czasowego lub pamięciowego.</span></li>
            <li>Każdy wiersz pliku wejściowego kończy się linuksowym znakiem końca linii (kod ASCII 10). <span style="color: #00ff00;">Poza tym w pliku wejściowym występują tylko drukowalne znaki kodu ASCII.</span></li>
        </ul>
        <p>Ponadto Twój program:</p>
        <ul>
            <li>Będzie miał do dyspozycji 256 MB pamięci.</li>
            <li>Przed zakończeniem musi zwolnić całą zaalokowaną pamięć.</li>
        </ul>
        <h3>Implementacja</h3>
        <p>Twoje rozwiązanie powinno zawierać następujące pliki:</p>
        <ul>
            <li><span style="font-family: courier new,courier,monospace;">trie.h<br></span>Plik nagłówkowy biblioteki wykonującej operacje na (jednym) drzewie TRIE.<span style="font-family: courier new,courier,monospace;"></span></li>
            <li><span style="font-family: courier new,courier,monospace;">trie.c<br></span>Implementacja biblioteki wykonującej operacje na (jednym) drzewie TRIE.</li>
            <li><span style="font-family: courier new,courier,monospace;">parse.h</span><br>Plik nagłówkowy biblioteki wczytującej liczby całkowite i napisy.</li>
            <li><span style="font-family: courier new,courier,monospace;">parse.c</span><br>Implementacja biblioteki wczytującej liczby całkowite i napisy.</li>
            <li><span style="font-family: courier new,courier,monospace;">dictionary.c</span><br>Główny plik programu, w którym wczytujemy wejście i wywołujemy funkcje z pliku <span style="font-family: courier new,courier,monospace;">trie.h</span>. Plik ten nie powinien znać typu danych służącego do przechowywania drzewa.</li>
        </ul>
        <p>Dodatkowo powinien być dołączony plik <span style="font-family: courier new,courier,monospace;">Makefile</span>, tak, aby w wyniku wywołania polecenia <span style="font-family: courier new,courier,monospace;">make</span> został wytworzony program wykonywalny <span style="font-family: courier new,courier,monospace;">dictionary</span>. Dodatkowo w wyniku wywołania polecenia <span style="font-family: courier new,courier,monospace;">make debug</span> powinien zostać wytworzony plik <span style="font-family: courier new,courier,monospace;">dictionary.dbg</span>, który powinien zawierać symbole do debugowania (opcja <span style="font-family: courier new,courier,monospace;">-g</span> kompilacji) tak, aby ułatwiało to śledzenie wycieków pamięci za pomocą programu <span style="font-family: courier new,courier,monospace;">valgrind</span>. Jeśli któryś z plików źródłowych ulegnie zmianie, ponowne wpisanie <span style="font-family: courier new,courier,monospace;">make</span> lub <span style="font-family: courier new,courier,monospace;">make debug</span> powinno na nowo stworzyć odpowiedni plik wykonywalny.</p>
        <p>Zachęcamy, by <span style="font-family: courier new,courier,monospace;">Makefile</span> działał w następujący sposób:</p>
        <ol>
            <li>osobno kompilował każdy plik <span style="font-family: courier new,courier,monospace;">.c</span> i osobno linkował,</li>
            <li>przy zmianie w pliku źródłowym powinny być wykonane tylko te polecenia kompilacji, które są potrzebne,</li>
            <li><span style="font-family: courier new,courier,monospace;">make clean</span> powoduje usunięcie wszystkich plików wykonywalnych i dodatkowych plików kompilacji.</li>
        </ol>
        <p>Jednak w tym zadaniu nie będziemy stosować kar punktowych za brak spełnienia tych trzech warunków.</p>
        <h3>Punktacja</h3>
        <p>Za w pełni poprawne rozwiązanie zadania implementujące wszystkie funkcjonalności można zdobyć maksymalnie 20 punktów. Możliwe są punkty karne za poniższe uchybienia:</p>
        <ul>
            <li>Za wycieki pamięci traci się co najwyżej 6 punktów.</li>
            <li>Za brak obsługi błędów na wejściu można stracić co najwyżej 5 punktów. (W takim wypadku implementacja plik <span style="font-family: courier new,courier,monospace;">parse.c</span> może zawierać trywialne wczytywanie).</li>
            <li><span style="color: #ff0000;">Programy <span style="color: #ff0000;">o złożoności pamięciowej liniowej względem sumy długości wszystkich słów w słowniku</span> są narażone na utratę ok. 5 punktów.</span></li>
            <li>Za brak obsługi parametrów wywołania <span style="font-family: courier new,courier,monospace;"></span>traci się co najwyżej 4 punkty.</li>
            <li>Za niezgodną ze specyfikacją strukturę plików w rozwiązaniu można stracić co najwyżej 4 punkty.</li>
            <li>Za błędy stylu kodowania można stracić co najwyżej 3 punkty.</li>
        </ul>
        <p>Za rozwiązanie, które przechowuje drzewo TRIE w postaci nieskompresowanej, nie obsługuje zapytań typu <span style="font-family: courier new,courier,monospace;">prev</span> i parametru wywołania <span style="font-family: courier new,courier,monospace;">-v</span>, można uzyskać maksymalnie 10 punktów. Za brak obsługi błędów na wejściu taki program może stracić co najwyżej 3 punkty.</p>
        <p>Przed pierwszym zgłoszeniem, za każde rozpoczęte 12 godzin opóźnienia przysługuje kara -1 pkt (dotyczy tylko dni roboczych). Zgłoszenie zostanie ocenione przez prowadzącego na zestawie testów, a student otrzyma raport ze sprawdzania. Za sprawdzenie każdego kolejnego zgłoszenia kara punktowa wynosi -1 punkt. Wówczas za każdy pełny dzień roboczy (0:00-23:59), który upłynie między podaniem wyniku oceny danego zgłoszenia a ponownym zgłoszeniem, kara punktowa wynosi -2 punkty. Ocena stylu rozwiązania następuje na ostatnim wykonanym zgłoszeniu (warto poinformować sprawdzającego, że rozwiązanie może zostać uznane za ostateczne).</p>
        <p>Rozwiązania należy implementować <strong>samodzielnie</strong> pod rygorem niezaliczenia przedmiotu.</p>
        <h3>Przykład</h3>
        <table style="width: 100%;" cellpadding="4" cellspacing="0"><colgroup><col width="64*"> <col width="64*"> </colgroup>
            <tbody>
                <tr valign="TOP">
                    <td style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm;" width="50%">
                        <p>Dla danych wejściowych:</p>
                        <p><span style="font-family: courier new,courier,monospace; font-size: medium;">insert aaaa<br>insert ababc<br>FIND aa<br>&nbsp;find&nbsp; aa<br>find bab<br>prev 1 1<br>4<br>prev 1 1 4<br>find bab<br>insert aaa<br>prev 0 0 2<br>find aaa<br>find aa a<br>find aba<br>delete 1<br>find aba<br>delete 1<br><span style="color: #ff0000;">insert abc</span><br>clear<br>insert ababc<br>prev 0 1 4<br>find bab</span></p>
<pre></pre>
                        </td>
                        <td style="border: 1px solid #000000; padding: 0.1cm;" width="50%">
                            <p>poprawnym wynikiem <span style="font-family: courier new,courier,monospace;"></span>jest:</p>
                            <p><span style="font-family: courier new,courier,monospace; font-size: medium;"></span><span style="font-family: courier new,courier,monospace; font-size: medium;">word number: 0<br>word number: 1<br>ignored<br>YES<br>NO<br>ignored<br>ignored<br>word number: 2<br>YES<br>word number: 3<br>ignored<br>YES<br>ignored<br>YES<br><span style="color: #ff0000;">deleted: 1</span><br>NO<br>ignored<br><span style="color: #ff0000;">word number: 4</span><br><span style="color: #ff0000;">cleared</span><br>word number: 0<br>word number: 1<br>YES</span></p>
<pre></pre>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <p>Jeśli program zostanie uruchomiony z parametrem <span style="font-family: courier new,courier,monospace;">-v</span>, na standardowe wyjście diagnostyczne powinien wypisać:</p>
                <table style="width: 100%;" cellpadding="4" cellspacing="0"><colgroup><col width="50*"> <col width="50*"> </colgroup>
                    <tbody>
                        <tr valign="TOP">
                            <td style="padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm; border: 1px solid #000000;" width="50%">
                                <p><span style="font-family: courier new,courier,monospace; font-size: medium;">nodes: 2<br> nodes: 4<br> nodes: 5<br> nodes: 6<br> nodes: 4<br><span style="color: #ff0000;">nodes: 6</span><br> nodes: 0<br> nodes: 2<br> nodes: 3</span></p>
<pre></pre>
                                </td>
                            </tr>
                        </tbody>
                            </table></div></div><div id="dates" class="box generalbox boxaligncenter"><table><tbody><tr>
                        </body>
                    </html>
